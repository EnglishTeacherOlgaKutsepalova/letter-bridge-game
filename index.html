<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Letter Bridge: Build and Read</title>
    <style>
        :root {
            --bg-url: url('https://EnglishTeacherOlgaKutsepalova.github.io/letter-bridge-game/location.png');
            --slot-url: url('https://EnglishTeacherOlgaKutsepalova.github.io/letter-bridge-game/bridge-slot.png');
            --panel-bg: rgba(255, 255, 255, 0.9);
        }
        
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; font-family: 'Arial', sans-serif; 
            display: flex; justify-content: center; align-items: center;
            background: #333;
        }
        
        /* Фиксированный размер игрового поля 1200x675 */
        #game-viewport {
            position: relative;
            width: 1200px;
            height: 675px;
            background: var(--bg-url) no-repeat center center;
            background-size: contain; /* Фон вмещается полностью */
            background-color: #000;
            overflow: hidden;
        }

        /* Прогресс-бар сверху */
        #progress-container {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 10px;
            background: rgba(0,0,0,0.2);
            z-index: 100;
        }
        #progress-bar {
            height: 100%; width: 0%;
            background: #2ecc71;
            transition: width 0.8s ease;
        }

        /* Персонаж - движение по центру по горизонтали */
        #hero {
            position: absolute;
            width: 100px;
            bottom: 250px; /* Высота по центру мостов на фоне */
            left: 50px; /* Старт у хижины слева */
            transition: left 1.5s ease-in-out;
            z-index: 10;
        }

        /* UI Слой */
        #ui-layer {
            position: absolute;
            top: 20px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            z-index: 20;
        }

        /* Блок с рупором (уменьшен в 3 раза) */
        .target-card {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--panel-bg);
            padding: 8px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        #target-image { height: 40px; border-radius: 5px; } /* x3 меньше предыдущих 120px */
        .audio-btn { cursor: pointer; width: 25px; }

        /* Собираемый мостик (x2 больше) */
        #bridge-slots { 
            display: flex; 
            gap: 15px; 
            padding: 15px;
            background: var(--panel-bg);
            border-radius: 20px;
        }
        .slot {
            width: 180px; /* Увеличено */
            height: 110px;
            background: var(--slot-url) no-repeat center bottom;
            background-size: contain;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Инвентарь (подсказки x2 больше, на подложке) */
        #inventory {
            position: absolute;
            bottom: 20px;
            width: auto;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 15px;
            background: var(--panel-bg);
            border-radius: 20px;
            z-index: 20;
        }
        .letter-block {
            width: 160px; /* Увеличено, соразмерно слоту */
            height: 100px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            cursor: grab;
        }

        #check-btn {
            padding: 12px 30px;
            font-size: 20px;
            border: none;
            background: #f39c12;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        /* Модальное окно Well Done на подложке */
        #win-message {
            display: none;
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: var(--panel-bg);
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            z-index: 200;
        }
        #win-message h1 { color: #2ecc71; font-size: 48px; margin: 0; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        .error-shake { animation: shake 0.3s ease-in-out 2; }
    </style>
</head>
<body>

<div id="game-viewport">
    <div id="progress-container"><div id="progress-bar"></div></div>
    
    <img id="hero" src="https://EnglishTeacherOlgaKutsepalova.github.io/letter-bridge-game/hero.png">

    <div id="ui-layer">
        <div class="target-card">
            <img id="target-image" src="">
            <img id="dictation-btn" class="audio-btn" src="https://EnglishTeacherOlgaKutsepalova.github.io/letter-bridge-game/dictation-btn.png" onclick="game.playAudio()">
        </div>
        
        <div id="bridge-slots"></div>
        <button id="check-btn" onclick="game.checkWord()">Check</button>
    </div>

    <div id="inventory"></div>

    <div id="win-message">
        <h1>Well done!</h1>
    </div>
</div>

<script>
const BASE = 'https://EnglishTeacherOlgaKutsepalova.github.io/letter-bridge-game/';

class BridgeGame {
    constructor() {
        this.levels = [
            { word: 'sat', img: 'sat.png', audio: 'sat.mp3' },
            { word: 'pat', img: 'pat.png', audio: 'pat.mp3' },
            { word: 'sit', img: 'sit.png', audio: 'sit.mp3' },
            { word: 'pit', img: 'pit.png', audio: 'pit.mp3' },
            { word: 'pin', img: 'pin.png', audio: 'pin.mp3' },
            { word: 'tin', img: 'tin.png', audio: 'tin.mp3' },
            { word: 'tip', img: 'tip.png', audio: 'tip.mp3' }
        ];
        this.currentIdx = 0;
        this.loadLevel();
    }

    loadLevel() {
        const level = this.levels[this.currentIdx];
        document.getElementById('target-image').src = BASE + level.img;
        
        const slotsCont = document.getElementById('bridge-slots');
        slotsCont.innerHTML = '';
        level.word.split('').forEach(() => {
            const slot = document.createElement('div');
            slot.className = 'slot';
            slot.ondragover = (e) => e.preventDefault();
            slot.ondrop = (e) => this.handleDrop(e);
            slotsCont.appendChild(slot);
        });

        this.renderInventory(level.word);
    }

    renderInventory(word) {
        const inv = document.getElementById('inventory');
        inv.innerHTML = '';
        const chars = word.split('').sort(() => Math.random() - 0.5);
        chars.forEach(char => {
            const block = document.createElement('div');
            block.className = 'letter-block';
            block.style.backgroundImage = `url(${BASE}${char}-hint.png)`;
            block.draggable = true;
            block.dataset.letter = char;
            block.ondragstart = (e) => {
                e.dataTransfer.setData('text', char);
                block.style.opacity = '0.4';
            };
            block.ondragend = () => block.style.opacity = '1';
            inv.appendChild(block);
        });
    }

    handleDrop(e) {
        e.preventDefault();
        const char = e.dataTransfer.getData('text');
        const slot = e.target.closest('.slot');
        if (slot && !slot.hasChildNodes()) {
            const block = document.createElement('div');
            block.className = 'letter-block';
            block.style.backgroundImage = `url(${BASE}${char}.png)`;
            block.dataset.letter = char;
            slot.appendChild(block);
            
            const original = Array.from(document.querySelectorAll('#inventory .letter-block'))
                                  .find(b => b.dataset.letter === char && b.style.opacity === '0.4');
            if (original) original.remove();
        }
    }

    checkWord() {
        const slots = document.querySelectorAll('.slot');
        let builtWord = '';
        slots.forEach(s => { if (s.firstChild) builtWord += s.firstChild.dataset.letter; });

        if (builtWord === this.levels[this.currentIdx].word) {
            this.handleSuccess();
        } else {
            this.handleError();
        }
    }

    handleSuccess() {
        this.currentIdx++;
        this.updateProgress();
        this.moveHero();

        if (this.currentIdx < this.levels.length) {
            setTimeout(() => this.loadLevel(), 1600);
        } else {
            setTimeout(() => {
                document.getElementById('win-message').style.display = 'block';
            }, 1000);
        }
    }

    handleError() {
        const slotsCont = document.getElementById('bridge-slots');
        slotsCont.classList.add('error-shake');
        setTimeout(() => {
            slotsCont.classList.remove('error-shake');
            this.loadLevel();
        }, 600);
    }

    updateProgress() {
        const percent = (this.currentIdx / this.levels.length) * 100;
        document.getElementById('progress-bar').style.width = percent + '%';
    }

    moveHero() {
        const hero = document.getElementById('hero');
        // Равномерное движение по горизонтали (от 50px до 1050px)
        const totalDistance = 1000; 
        const step = totalDistance / this.levels.length;
        const newLeft = 50 + (step * this.currentIdx);
        
        hero.src = BASE + 'hero.gif';
        hero.style.left = newLeft + 'px';
        setTimeout(() => hero.src = BASE + 'hero.png', 1500);
    }

    playAudio() {
        new Audio(BASE + this.levels[this.currentIdx].audio).play();
    }
}

const game = new BridgeGame();
</script>
</body>
</html>
