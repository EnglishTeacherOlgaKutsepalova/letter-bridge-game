<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Letter Bridge: Professional Edition</title>
    <style>
        :root {
            --bg-url: url('https://EnglishTeacherOlgaKutsepalova.github.io/letter-bridge-game/location.png');
            --ui-bg: url('https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/letter-bridge-game/main/background.png');
            --hint-bg: url('https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/letter-bridge-game/main/background1.png');
            --word-bg: url('https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/letter-bridge-game/main/wordbackground.png');
        }
        
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #222; display: flex; justify-content: center; align-items: center; }
        
        /* Фиксированное разрешение 1680x945 */
        #game-viewport {
            position: relative;
            width: 1680px;
            height: 945px;
            background: var(--bg-url) no-repeat center center;
            background-size: 110%; /* Начальный зум */
            transition: background-size 2.5s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }

        /* Кнопка Старт x5 */
        #start-screen { position: absolute; inset: 0; display: flex; justify-content: center; align-items: center; z-index: 1000; background: rgba(0,0,0,0.6); }
        #start-button { cursor: pointer; width: 600px; transition: transform 0.3s; }
        #start-button:hover { transform: scale(1.05); }

        /* Описание игры (Центрирование + x2 отступы) */
        #dialog-box {
            display: none;
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 800px;
            height: 450px;
            background: var(--ui-bg) no-repeat center;
            background-size: contain;
            z-index: 500;
            padding: 80px 120px; /* Увеличенные отступы слева/справа */
            text-align: center;
            box-sizing: border-box;
            cursor: pointer;
        }

        #hero-container {
            position: absolute;
            width: 140px;
            height: 140px;
            z-index: 100;
            transition: all 1.2s ease-in-out;
            display: none;
        }
        #hero { width: 100%; }

        /* UI Заданий */
        #ui-layer {
            display: none;
            position: absolute;
            top: 40px; width: 100%;
            flex-direction: column;
            align-items: center;
            gap: 25px;
            z-index: 50;
        }

        .target-card {
            background: var(--word-bg) no-repeat center;
            background-size: contain;
            padding: 30px 60px;
            display: flex; align-items: center; gap: 20px;
        }

        #bridge-slots { 
            background: var(--hint-bg) no-repeat center;
            background-size: 100% 100%;
            padding: 40px;
            display: flex; gap: 15px;
        }

        #inventory {
            position: absolute;
            bottom: 40px; left: 50%;
            transform: translateX(-50%);
            display: flex; gap: 20px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
        }

        .slot, .letter-block { width: 180px; height: 110px; background-size: contain; background-repeat: no-repeat; background-position: center; }
        
        #progress-container { position: absolute; top: 0; width: 100%; height: 15px; background: rgba(0,0,0,0.4); z-index: 200; }
        #progress-bar { height: 100%; width: 0%; background: #2ecc71; transition: width 0.6s; }

        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-15px); } 75% { transform: translateX(15px); } }
        .error-shake { animation: shake 0.4s ease-in-out 2; }
    </style>
</head>
<body>

<div id="game-viewport">
    <div id="start-screen">
        <img id="start-button" src="https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/letter-bridge-game/main/startbutton.png" onclick="startGame()">
    </div>

    <div id="progress-container"><div id="progress-bar"></div></div>

    <div id="hero-container">
        <img id="hero" src="https://EnglishTeacherOlgaKutsepalova.github.io/letter-bridge-game/hero.png">
    </div>

    <div id="dialog-box" onclick="startFirstTask()">
        <h2 style="color: #4a2f1b; margin-bottom: 20px;">Welcome!</h2>
        <p id="dialog-text" style="font-size: 24px; line-height: 1.4; color: #4a2f1b; font-weight: bold;"></p>
    </div>

    <div id="ui-layer">
        <div class="target-card">
            <img id="target-image" style="height: 80px;">
            <img src="https://EnglishTeacherOlgaKutsepalova.github.io/letter-bridge-game/dictation-btn.png" style="width: 50px; cursor: pointer;" onclick="game.playAudio()">
        </div>
        <div id="bridge-slots"></div>
        <button onclick="game.checkWord()" style="padding: 15px 40px; font-size: 24px; cursor: pointer; background: #f39c12; border: none; border-radius: 10px; color: white;">Check Word</button>
    </div>

    <div id="inventory"></div>
</div>

<script>
const BASE = 'https://EnglishTeacherOlgaKutsepalova.github.io/letter-bridge-game/';

// Координаты 0-7 согласно фото
const PATH = [
    {x: 80, y: 680},   // 0 (Хижина)
    {x: 430, y: 700},  // 1
    {x: 650, y: 800},  // 2
    {x: 950, y: 680},  // 3
    {x: 750, y: 550},  // 4
    {x: 550, y: 480},  // 5
    {x: 800, y: 430},  // 6
    {x: 1100, y: 180}  // 7 (Замок)
];

function startGame() {
    document.getElementById('start-screen').style.display = 'none';
    const vp = document.getElementById('game-viewport');
    vp.style.backgroundSize = '100%'; 
    
    const hc = document.getElementById('hero-container');
    hc.style.display = 'block';
    hc.style.left = PATH[0].x + 'px';
    hc.style.top = PATH[0].y + 'px';
    
    setTimeout(showIntro, 2000);
}

function showIntro() {
    const db = document.getElementById('dialog-box');
    db.style.display = 'block';
    document.getElementById('dialog-text').innerText = "Hello! Help me build the words and cross the bridges to get to the castle. Listen, drag and drop the bridge blocks to make the words.";
}

function startFirstTask() {
    document.getElementById('dialog-box').style.display = 'none';
    document.getElementById('ui-layer').style.display = 'flex';
    game.loadLevel();
}

class BridgeGame {
    constructor() {
        this.levels = [
            { word: 'sat', img: 'sat.png', audio: 'sat.mp3' },
            { word: 'pat', img: 'pat.png', audio: 'pat.mp3' },
            { word: 'sit', img: 'sit.png', audio: 'sit.mp3' },
            { word: 'pit', img: 'pit.png', audio: 'pit.mp3' },
            { word: 'pin', img: 'pin.png', audio: 'pin.mp3' },
            { word: 'tin', img: 'tin.png', audio: 'tin.mp3' },
            { word: 'tip', img: 'tip.png', audio: 'tip.mp3' }
        ];
        this.currentIdx = 0;
    }

    loadLevel() {
        const lvl = this.levels[this.currentIdx];
        document.getElementById('target-image').src = BASE + lvl.img;
        const slots = document.getElementById('bridge-slots');
        slots.innerHTML = '';
        lvl.word.split('').forEach(() => {
            const s = document.createElement('div');
            s.className = 'slot';
            s.style.backgroundImage = `url(${BASE}bridge-slot.png)`;
            s.ondragover = (e) => e.preventDefault();
            s.ondrop = (e) => this.handleDrop(e);
            slots.appendChild(s);
        });
        this.renderInventory(lvl.word);
    }

    renderInventory(word) {
        const inv = document.getElementById('inventory');
        inv.innerHTML = '';
        word.split('').sort(() => Math.random() - 0.5).forEach(char => {
            const b = document.createElement('div');
            b.className = 'letter-block';
            b.style.backgroundImage = `url(${BASE}${char}-hint.png)`;
            b.draggable = true;
            b.dataset.letter = char;
            b.ondragstart = (e) => e.dataTransfer.setData('text', char);
            inv.appendChild(b);
        });
    }

    handleDrop(e) {
        e.preventDefault();
        const char = e.dataTransfer.getData('text');
        const slot = e.target.closest('.slot');
        if (slot && !slot.hasChildNodes()) {
            const b = document.createElement('div');
            b.className = 'letter-block';
            b.style.backgroundImage = `url(${BASE}${char}.png)`;
            b.dataset.letter = char;
            slot.appendChild(b);
            // Удаляем из инвентаря
            const original = Array.from(document.querySelectorAll('#inventory .letter-block')).find(el => el.dataset.letter === char);
            if(original) original.remove();
        }
    }

    checkWord() {
        const slots = document.querySelectorAll('.slot');
        let built = '';
        slots.forEach(s => { if(s.firstChild) built += s.firstChild.dataset.letter; });
        
        if (built === this.levels[this.currentIdx].word) {
            this.handleSuccess();
        } else {
            this.handleError();
        }
    }

    handleSuccess() {
        this.currentIdx++;
        document.getElementById('progress-bar').style.width = (this.currentIdx / this.levels.length * 100) + '%';
        this.moveHero();
        if (this.currentIdx < this.levels.length) {
            setTimeout(() => this.loadLevel(), 1500);
        } else {
            setTimeout(() => { location.href = 'https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/letter-bridge-game/main/cover.gif'; }, 2000);
        }
    }

    handleError() {
        const sc = document.getElementById('bridge-slots');
        sc.classList.add('error-shake');
        setTimeout(() => {
            sc.classList.remove('error-shake');
            this.loadLevel(); // Возвращаем буквы в инвентарь (перезагрузка уровня)
        }, 500);
    }

    moveHero() {
        const hc = document.getElementById('hero-container');
        const h = document.getElementById('hero');
        const p = PATH[this.currentIdx];
        h.src = BASE + 'hero.gif';
        hc.style.left = p.x + 'px';
        hc.style.top = p.y + 'px';
        setTimeout(() => h.src = BASE + 'hero.png', 1200);
    }

    playAudio() { new Audio(BASE + this.levels[this.currentIdx].audio).play(); }
}

const game = new BridgeGame();
</script>
</body>
</html>
