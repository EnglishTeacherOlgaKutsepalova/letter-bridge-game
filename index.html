<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Letter Bridge: Precision Movement</title>
    <style>
        :root {
            --bg-url: url('https://EnglishTeacherOlgaKutsepalova.github.io/letter-bridge-game/location.png');
            --ui-bg: url('https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/letter-bridge-game/main/background.png');
            --hint-bg: url('https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/letter-bridge-game/main/background1.png');
            --word-bg: url('https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/letter-bridge-game/main/wordbackground.png');
            --slot-url: url('https://EnglishTeacherOlgaKutsepalova.github.io/letter-bridge-game/bridge-slot.png');
        }
        
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; display: flex; justify-content: center; align-items: center; }
        
        #game-viewport {
            position: relative;
            width: 1680px;
            height: 945px;
            background: var(--bg-url) no-repeat center center;
            background-size: cover;
            overflow: hidden;
        }

        #start-screen { position: absolute; inset: 0; display: flex; justify-content: center; align-items: center; z-index: 1000; background: rgba(0,0,0,0.8); }
        #start-button { cursor: pointer; width: 600px; transition: transform 0.2s; }
        #start-button:hover { transform: scale(1.05); }

        #dialog-box {
            display: none;
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 850px;
            height: 500px;
            background: var(--ui-bg) no-repeat center;
            background-size: contain;
            z-index: 500;
            padding: 80px 140px;
            text-align: center;
            box-sizing: border-box;
            cursor: pointer;
        }

        #hero-container {
            position: absolute;
            width: 150px;
            height: 150px;
            z-index: 100;
            transition: all 1.2s ease-in-out;
            display: none;
            transform: translate(-50%, -100%);
        }
        #hero { width: 100%; }

        #ui-layer {
            display: none;
            position: absolute;
            top: 30px; width: 100%;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            z-index: 50;
        }

        .target-card {
            background: var(--word-bg) no-repeat center;
            background-size: contain;
            padding: 25px 50px;
            display: flex; align-items: center; gap: 20px;
        }

        #bridge-slots { 
            background: var(--ui-bg) no-repeat center;
            background-size: 100% 100%;
            padding: 40px 60px;
            display: flex; gap: 8px; 
        }

        .slot, .letter-block { width: 170px; height: 110px; background-size: contain; background-repeat: no-repeat; background-position: center; }
        .slot { background-image: var(--slot-url); }

        #inventory {
            display: none;
            position: absolute;
            bottom: 30px; left: 50%;
            transform: translateX(-50%);
            gap: 20px;
            padding: 40px 80px;
            background: var(--hint-bg) no-repeat center;
            background-size: 100% 100%;
            min-width: 400px;
            justify-content: center;
            z-index: 50;
        }

        #progress-container { position: absolute; top: 0; width: 100%; height: 12px; background: rgba(0,0,0,0.4); z-index: 200; }
        #progress-bar { height: 100%; width: 0%; background: #2ecc71; transition: width 0.6s; }
        
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-15px); } 75% { transform: translateX(15px); } }
    </style>
</head>
<body>

<div id="game-viewport">
    <div id="start-screen">
        <img id="start-button" src="https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/letter-bridge-game/main/startbutton.png" onclick="startGame()">
    </div>
    <div id="progress-container"><div id="progress-bar"></div></div>
    <div id="hero-container"><img id="hero" src="https://EnglishTeacherOlgaKutsepalova.github.io/letter-bridge-game/hero.png"></div>
    <div id="dialog-box" onclick="startFirstTask()"><p id="dialog-text" style="font-size: 26px; line-height: 1.4; color: #4a2f1b; font-weight: bold; margin-top: 60px;"></p></div>
    
    <div id="ui-layer">
        <div class="target-card">
            <img id="target-image" style="height: 70px;">
            <img src="https://EnglishTeacherOlgaKutsepalova.github.io/letter-bridge-game/dictation-btn.png" style="width: 45px; cursor: pointer;" onclick="game.playAudio()">
        </div>
        <div id="bridge-slots"></div>
        <button onclick="game.checkWord()" style="margin-top:10px; padding: 12px 35px; font-size: 22px; cursor: pointer; background: #f39c12; border: none; border-radius: 10px; color: white; font-weight: bold; box-shadow: 0 4px 0 #d35400;">Check Word</button>
    </div>
    <div id="inventory"></div>
</div>

<script>
const BASE = 'https://EnglishTeacherOlgaKutsepalova.github.io/letter-bridge-game/';

// Координаты перенастроены по твоей инструкции:
const PATH = [
    {x: 510, y: 492},  // 0: 470+40 вправо, 472+20 вниз
    {x: 792, y: 651},  // 1: 692+100 вправо
    {x: 1037, y: 775}, // 2: 937+100 вправо
    {x: 1213, y: 595}, // 3: 645-50 вверх
    {x: 967, y: 541},  // 4: 1067-100 влево, 531+10 вниз
    {x: 836, y: 542},  // 5: 886-50 влево, 462+80 вниз
    {x: 764, y: 420},  // 6: 1064-300 влево, 410+10 вниз
    {x: 1219, y: 591}  // 7: 1319-100 влево, 191+400 вниз
];

function startGame() {
    document.getElementById('start-screen').style.display = 'none';
    const hc = document.getElementById('hero-container');
    hc.style.display = 'block';
    hc.style.left = PATH[0].x + 'px';
    hc.style.top = PATH[0].y + 'px';
    setTimeout(showIntro, 400);
}

function showIntro() {
    const db = document.getElementById('dialog-box');
    db.style.display = 'block';
    document.getElementById('dialog-text').innerText = "Hello! Help me build the words and cross the bridges to get to the castle. Listen, drag and drop the bridge blocks to make the words.";
}

function startFirstTask() {
    document.getElementById('dialog-box').style.display = 'none';
    document.getElementById('ui-layer').style.display = 'flex';
    game.loadLevel();
}

class BridgeGame {
    constructor() {
        this.levels = [
            { word: 'sat', img: 'sat.png', audio: 'sat.mp3' },
            { word: 'pat', img: 'pat.png', audio: 'pat.mp3' },
            { word: 'sit', img: 'sit.png', audio: 'sit.mp3' },
            { word: 'pit', img: 'pit.png', audio: 'pit.mp3' },
            { word: 'pin', img: 'pin.png', audio: 'pin.mp3' },
            { word: 'tin', img: 'tin.png', audio: 'tin.mp3' },
            { word: 'tip', img: 'tip.png', audio: 'tip.mp3' }
        ];
        this.currentIdx = 0;
    }

    loadLevel() {
        const lvl = this.levels[this.currentIdx];
        document.getElementById('target-image').src = BASE + lvl.img;
        const slots = document.getElementById('bridge-slots');
        slots.innerHTML = '';
        lvl.word.split('').forEach(() => {
            const s = document.createElement('div');
            s.className = 'slot';
            s.ondragover = (e) => e.preventDefault();
            s.ondrop = (e) => this.handleDrop(e);
            slots.appendChild(s);
        });
        
        document.getElementById('inventory').style.display = 'flex';
        this.renderInventory(lvl.word);
    }

    renderInventory(word) {
        const inv = document.getElementById('inventory');
        inv.innerHTML = '';
        word.split('').sort(() => Math.random() - 0.5).forEach(char => {
            const b = document.createElement('div');
            b.className = 'letter-block';
            b.style.backgroundImage = `url(${BASE}${char}-hint.png)`;
            b.draggable = true;
            b.dataset.letter = char;
            b.ondragstart = (e) => e.dataTransfer.setData('text', char);
            inv.appendChild(b);
        });
    }

    handleDrop(e) {
        e.preventDefault();
        const char = e.dataTransfer.getData('text');
        const slot = e.target.closest('.slot');
        if (slot && !slot.hasChildNodes()) {
            const b = document.createElement('div');
            b.className = 'letter-block';
            b.style.backgroundImage = `url(${BASE}${char}.png)`;
            b.dataset.letter = char;
            slot.appendChild(b);
            const original = Array.from(document.querySelectorAll('#inventory .letter-block')).find(el => el.dataset.letter === char);
            if(original) original.remove();
        }
    }

    checkWord() {
        const slots = document.querySelectorAll('.slot');
        let built = '';
        slots.forEach(s => { if(s.firstChild) built += s.firstChild.dataset.letter; });
        
        if (built === this.levels[this.currentIdx].word) {
            this.handleSuccess();
        } else {
            const sc = document.getElementById('bridge-slots');
            sc.style.animation = 'shake 0.4s ease-in-out 2';
            setTimeout(() => { sc.style.animation = ''; this.loadLevel(); }, 500);
        }
    }

    handleSuccess() {
        this.currentIdx++;
        document.getElementById('progress-bar').style.width = (this.currentIdx / this.levels.length * 100) + '%';
        document.getElementById('inventory').style.display = 'none';
        
        this.moveHero();
        if (this.currentIdx < this.levels.length) {
            setTimeout(() => this.loadLevel(), 1500);
        } else {
            setTimeout(() => { window.location.href = 'https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/letter-bridge-game/main/cover.gif'; }, 2000);
        }
    }

    moveHero() {
        const hc = document.getElementById('hero-container');
        const h = document.getElementById('hero');
        const p = PATH[this.currentIdx];
        h.src = BASE + 'hero.gif';
        hc.style.left = p.x + 'px';
        hc.style.top = p.y + 'px';
        setTimeout(() => h.src = BASE + 'hero.png', 1200);
    }

    playAudio() { new Audio(BASE + this.levels[this.currentIdx].audio).play(); }
}
const game = new BridgeGame();
</script>
</body>
</html>
